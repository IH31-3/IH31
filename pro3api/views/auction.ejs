<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- reset css -->
    <link rel="stylesheet" type="text/css" href="/public/css/destyle.css">

    <!-- header css -->
    <link rel="stylesheet" type="text/css" href="/public/css/csHeader.css">
    
    <!-- main css -->
    <link rel="stylesheet" type="text/css" href="/public/css/main.css">

    <!-- footer css -->
    <link rel="stylesheet" type="text/css" href="/public/css/csFooter.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>

    <title>TOP | HALMOTOR</title>
</head>

    <body>
        <header>
            <div id="header-width">
                <nav>
                    <ul>
                        <li><a href="./index.php"><img id="logo" src="/public/img/HALMOTORw.png" alt="HALMORTOR" width="350px"></a></li>
                        <li class="mNav"><a href="http://127.0.0.1/IH31/customer/index.php?page=history_top"><img src="/public/img/home.png" width="2px">TOP</a></li>
                        <li class="mNav"><a href="http://127.0.0.1/IH31/customer/index.php?page=auction_top"><img src="/public/img/auction.png" width="2px">AUCTION</a></li>
                        <li class="mNav"><a href="http://127.0.0.1/IH31/customer/index.php?page=mypage_top"><img src="/public/img/mypage.png" width="2px">MY PAGE</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <!-- header ここまで-->

        <main>
            <h2 class="mgn_top40 auto_center left border_bottom font_gray font_size_middle bold">BID THIS AUCTION</h2>
            <div class="width auto_center">
                <h3 class="mgn_bottom40 postit_gray bold big mgn_top40 font_gray2">車名　<%= vehicle['model_name'] %>
                </h3>
            </div>
            <div id="contents_wrap">
    
                <!-- 画像 -->
                <article id="img_area">
                    <img id="main_img" src="/public/car_img/<%= room %>_0.jpg">
                    <div class="flex">
                        <img class="img_cont" src="/public/car_img/<%= room %>_1.jpg">
                        <img class="img_cont" src="/public/car_img/<%= room %>_2.jpg">
                        <img class="img_cont" src="/public/car_img/<%= room %>_3.jpg">
                    </div>
                </article>
    
                <!-- オークション情報 -->
                <article id="auction_info">
                    <section class="frame">
                        <h4 class="frame_gray">開始価格</h4>
                        <p class="bold center gray">
                            <%= start %> <span class="font_size_middle">万円</span>
                        </p>
                    </section>
    
                    <section class="frame">
                        <h4 class="frame_gray">入札件数</h4>
                        <p id="count" class="center bold gray">
                            <%= count %>
                                <span class="font_size_middle">件</span>
                        </p>
                    </section>
    
                    <section class="frame">
                        <h4 class="frame_pink">現在落札価格</h4>
                        <p id="money" class="bold center pink">
                            <%= money + "万円" %><span class="font_size_middle"></span>
                        </p>
                    </section>
    
                    <section class="frame">
                        <h4 class="frame_blue">残り時間</h4>
                        <p id="time" class="bold center blue">
                            <%= time %>
                        </p>
                    </section>
    
                    <section id="annotation">
                        <p><small>※開始価格には、整備費用を含みます。</small></p>
                        <p><small>※落札価格によって価格は変動します。</small></p>
                        <p><small>※落札後、当社の社員がお電話いたします。</small></p>
                        <p><small>※落札後、キャンセルされる場合はキャンセル料が発生します。</small></p>
                    </section>
    
                </article>
            </div>
            <div id="car_info_wrap">
                <!-- 入札部分 -->
                <article id="auction_info_input">
                    <!-- <p class="mgn_bottom20 center"><span class="bold gray">現在落札価格</span> 　　<span class="pink bold big"><%= money %></span><span class="bold gray">　万円</span> </p> -->
                    <p class="mgn_bottom20"><span id="display" class="back_yellow">現在あなたが暫定落札者です</span></p><!-- 落札者のときは表示 -->
                    <form class="center" id="myform">
                        <p class="mgn_bottom20 center bold gray">入札額を入力する</p>
                        <label>
                            <input class="big bold gray border_bottom" id="input" name="text" type="text"> <span class="bold gray">　万円</span>
                        </label>
                        <!-- 消さないで-->
                        <p><input id="customer" type="hidden" name="hidden" value="<%= customer %>"></p>
                        <p><input id="chat" type="hidden" name="chat" value="<%= room %>"></p>
                        <!-- 消さないで -->
                        <button class="btn3 mgn_bottom40" id="button" name="btn" value="">この価格で入札する</button>
                    </form>
                </article>
                <p id="end"></p>
    
                <article id="car_detail">
                    <section>
                        <h3 class="border_bottom gray bold middle">基本情報</h3>
                        <table>
                            <tr>
                                <td>メーカー</td>
                                <td>
                                    <%= vehicle['maker'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>車種名</td>
                                <td>
                                    <%= vehicle['model_name'] %>
                                </td>
    
                            </tr>
                            <tr>
                                <td>形状</td>
                                <td>
                                    <%= vehicle['shape'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>年式</td>
                                <td>
                                    <%= vehicle['model_year'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>排気量</td>
                                <td>
                                    <%= vehicle['displacement'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>モデル</td>
                                <td>
                                    <%= vehicle['model'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>グレード</td>
                                <td>
                                    <%= vehicle['grade'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>燃料</td>
                                <td>
                                    <%= vehicle['fuel'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>型式</td>
                                <td>
                                    <%= vehicle['vehicle_model'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>定員</td>
                                <td>
                                    <%= vehicle['capacity'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>駆動方式</td>
                                <td>
                                    <%= vehicle['drive_system'] %>
                                </td>
                            </tr>
    
                            <tr>
                                <td>走行距離</td>
                                <td>
                                    <%= vehicle['mileage'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>外装色</td>
                                <td>
                                    <%= vehicle['exterior_color'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>内装色</td>
                                <td>
                                    <%= vehicle['Interior_color'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>Nox期限</td>
                                <td>
                                    <%= vehicle['nox_deadline'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>検査期限</td>
                                <td>
                                    <%= vehicle['Inspection_deadline'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>名変期限</td>
                                <td>
                                    <%= vehicle['name_change_deadline'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>エアバッグ</td>
                                <td>
                                    <%= vehicle['airbag'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>車歴</td>
                                <td>
                                    <%= vehicle['car_history'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>種別区分番号</td>
                                <td>
                                    <%= vehicle['classification_classification_number'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>修理歴</td>
                                <td>
                                    <%= vehicle['repair_history'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>評価点</td>
                                <td>
                                    <%= vehicle['evaluation_points'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>外装評価</td>
                                <td>
                                    <%= vehicle['exterior_evaluation'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>内装評価</td>
                                <td>
                                    <%= vehicle['interior_evaluation'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>状態コメント</td>
                                <td>
                                    <%= vehicle['situation_comment'] %>
                                </td>
                            </tr>
                            <tr>
                                <td>アピールポイント</td>
                                <td>
                                    <%= vehicle['appeal_point'] %>
                                </td>
                            </tr>
    
                        </table>
                    </section>
                </article>
    
            </div>
    
    
            <!-- <a href="http://127.0.0.1/IH31/customer/index.php">トップへ戻る</a> -->
        </main>
        <!-- main ここまで -->
        <footer>
            <div id="footer-top">
                <div id="footer-content">
                    <div class="edge">
                        <p class="bold">支払い方法、注文後の流れ、その他サービスに関する不明点について、お気軽に問い合わせください。</p>
                        <p class="pink bold">[ HAL MOTORホットライン ]</p>
                        <p class="pink big bold">0120-01-xxxx（通話無料）</p>
                        <p>11時～13時、14時～17時　※土日祝日・年末年始除く　<span class="thin">※電話内容につきましては正確を期するため、録音をしております</span></p>
                    </div>
                </div>
            </div>
            <div id="footer-middle">
                <ul>
                    <li class="bold">ABOUT HAL MOTORS 　/　 LINKS　 / 　LICENSE</li>
                    <li><img src="/public/img/HALMOTORw.png" width="250px"></li>
                </ul>
            </div>
            <p id="footer-bottom"><small>＠2021 HAL MOTORS All Rights Reserved</small></p>
        </footer>


        <!--ノード実行用ＪＳ-->
        <script>
            const socketio = io();

            /**
             * オークション落札者表示を消しておく
             * @type Element
             */
            var display = document.getElementById("display");
            display.style.display = " none";

            /**
             * オークション識別子
             * @type Element.value
             */
            var chat = document.getElementById("chat").value;
            var sendData = {
                auction: chat
            };
            socketio.emit('c2s-join', sendData);


            /**
             * 時間取得
             * @param {type} event
             * @returns {undefined}
             */
            socketio.on('s2cx', function (strDiff) {
                console.log('ソケット' + strDiff);
                var time = document.getElementById("time");
                time.innerHTML = strDiff;
            })

            /**
             *終了 
             * @type type
             */
            socketio.on('end', function () {
                console.log('終了ソケット');
                var end = document.getElementById("end");

                var button = document.getElementById("button");
                button.disabled = true;
                //alert("終了しました");
            })

            /**
             * オークション　下り
             * @type type
             */
            socketio.on('auction_d', function (msg) {
                console.log('オークション');
                var ul = document.getElementById("message");
                var li = document.createElement('li');
                var mon = document.getElementById("money");
                var cnt = document.getElementById("count");
//                li.innerHTML = msg;
                mon.innerHTML = msg.msg+"万円";
                cnt.innerHTML = msg.count;
//                ul.appendChild(li);
                console.log(msg);
                //落札者表示を消す 返答id と顧客ID が一致しない場合
                var customer = document.getElementById("customer").value;
                console.log("customer :" + customer);
                console.log(!(parseInt(customer) == parseInt(msg.customer)));
                if (!(parseInt(customer) == parseInt(msg.customer))) {
                    var display = document.getElementById("display");
                    display.style.display = "none";
                }
            })

            /**
             * オークション　上り
             * @type Element
             */
            const form = document.getElementById("myform");
            form.addEventListener("submit", function (event) {
                event.preventDefault();
                var input_message = document.getElementById("input").value;
                var room = document.getElementById("chat").value;
                var customer = document.getElementById("customer").value;
                var message = {
                    msg: input_message,
                    room: room,
                    customer: customer
                };

                socketio.emit('auction', message);

                //落札者表示を表示  

                var display = document.getElementById("display");
                display.style.display = "block";

            });




        </script>

    </body>

</html>